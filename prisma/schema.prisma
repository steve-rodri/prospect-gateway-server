// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    Int            @id @default(autoincrement())
  username              String         @db.VarChar(20)
  email                 String         @unique
  password              String         @db.VarChar(200)
  walletBalance         Decimal        @db.Money
  totalHoldingsValue    Decimal        @default(0)
  holdings              Holding[]
  competitionUserOne    Competition[]  @relation(name: "competitionUserOne")
  competitionUserTwo    Competition[]  @relation(name: "competitionUserTwo")
  notificationSender    Notification[] @relation(name: "notificationSender")
  notificationRecipient Notification[] @relation(name: "notificationRecipient")
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model CompetitionType {
  id             Int          @id @default(autoincrement())
  name           String       @db.VarChar(40)
  athleteLimit   Int?
  moneyLimit     Decimal?
  durationInDays Int?
  competition    Competition?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

model Competition {
  id                Int                  @id @default(autoincrement())
  competitionType   CompetitionType      @relation(fields: [competitionTypeId], references: [id])
  competitionTypeId Int                  @unique
  active            Boolean              @default(true)
  startTime         DateTime             @default(now())
  endTime           DateTime
  userResult        String               @db.VarChar(1)
  athletes          AthleteCompetition[]
  userOne           User?                @relation(fields: [userOneId], references: [id], name: "competitionUserOne")
  userTwo           User?                @relation(fields: [userTwoId], references: [id], name: "competitionUserTwo")
  userOneId         Int                  @unique
  userTwoId         Int                  @unique
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
}

model Athlete {
  id              Int                  @id @default(autoincrement())
  name            String               @db.VarChar(50)
  age             Int
  position        String               @db.VarChar(5)
  origin          String               @db.VarChar(50)
  teamAbbr        String               @db.VarChar(50)
  photoUri        String               @db.VarChar(200)
  pointAverage    Decimal?
  reboundAverage  Decimal?
  assistAverage   Decimal?
  blockAverage    Decimal?
  stealAverage    Decimal?
  turnoverAverage Decimal?
  userHoldings    Holding[]
  stockData       StockPrice[]
  competitions    AthleteCompetition[]
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
}

model AthleteCompetition {
  athlete       Athlete     @relation(fields: [athleteId], references: [id])
  athleteId     Int         @unique
  competition   Competition @relation(fields: [competitionId], references: [id])
  competitionId Int         @unique
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@id([athleteId, competitionId])
}

model Holding {
  id           Int      @id @default(autoincrement())
  user         User     @relation(fields: [userId], references: [id])
  userId       Int      @unique
  athlete      Athlete  @relation(fields: [athleteId], references: [id])
  athleteId    Int      @unique
  shareAmt     Float
  purchaseDate DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model StockPrice {
  id        Int      @id @default(autoincrement())
  date      DateTime
  price     Decimal  @db.Money
  athlete   Athlete  @relation(fields: [athleteId], references: [id])
  athleteId Int      @unique
}

model Notification {
  id          Int                @id @default(autoincrement())
  type        NotificationType
  sender      User?              @relation(name: "notificationSender", fields: [senderId], references: [id])
  senderId    Int                @unique
  recipient   User?              @relation(name: "notificationRecipient", fields: [recipientId], references: [id])
  recipientId Int                @unique
  status      NotificationStatus @default(pending)
  dateSent    DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
}

enum NotificationType {
  Competition
  FriendRequest
}

enum NotificationStatus {
  rejected
  pending
  success
}
